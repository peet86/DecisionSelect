// DecisionSelect: jquery plugin to display an HTML question-answer tree as a flat decision-select list
// version 1.0
// (c) 2015 Peter Varga [info@vargapeter.com]
// released under the Apache 2.0 license

!function(e){e.decisionSelect=function(n,t){var i=this;i.$el=e(n),i.el=n,i.$el.data("decisionSelect",i),i.init=function(){return i.options=e.extend({},e.decisionSelect.defaultOptions,t),i.options.tree.length>0?(i.generate(i.options.tree,i.$el,0,"/"),e(".qac:not(:first)").hide(),void(i.options.remove&&i.options.tree.remove())):void(i.options.debug&&e.error("Missing 'tree' object."))},i.generate=function(n,t,o,a){o++,n.children(i.options.container).each(function(){var n=e(this),s=n.children(i.options.containerIn),l=n.children(i.options.containerSub),c=s.html(),r=s.attr(i.options.attrLink);if(o%2)if(l.length>0){var p=e("<div class='qac' data-link='"+a+"'></div>"),d=e("<a class='qaq'>"+c+"</a>"),u=e("<select class='qas'></select>"),h=e("<option class='qaa' selected='selected' value=''>"+i.options.please+"</option>");i.$el.append(p),p.append(d),p.append(u),u.append(h),t=u,t.on("change",function(){var n=e(this).val();if(e(this).parent().nextAll(".qac").hide().find("select option:eq(0)").prop("selected",!0),i.options.onAnswer.call(i,n),""!=n){var t=e('.qac[data-link="'+n+'"]');t.length>0?t.show():i.options.onFinalAnswer.call(i,n)}}),i.generate(l,t,o,a)}else i.options.debug&&e.error("Question without answer ("+c+")");else $o=e("<option class='qaa' value='"+r+"'>"+c+"</option>"),t.append($o),l.length>0&&i.generate(l,t,o,r)})},i.init()},e.decisionSelect.defaultOptions={debug:!1,tree:"null",remove:!0,please:"Pelase select..",attrLink:"href",container:"li",containerSub:"ul",containerIn:"a",onFinalAnswer:function(){},onAnswer:function(){}},e.fn.decisionSelect=function(n){return this.each(function(){new e.decisionSelect(this,n)})}}(jQuery);
